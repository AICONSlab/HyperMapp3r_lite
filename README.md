# HyperMapp3r_lite

- segments white matter hyperintensities (WMHs) using T1/FLAIR
- streamlined version of HyperMapp3r (https://github.com/AICONSlab/HyperMapp3r) for command line segmentation of WMHs

# Inputs
masked, bias corrected, coregistered T1 and FLAIR images

# Before installing HyperMapp3r_lite

## Acknowledging this work 
If you wish to include results generated by HyperMapp3r in a publication, please include a line such as the following:

> White Matter Hyperintensity (WMH) segmentation was performing using the HyperMapp3r algorithm based on a convolutional neural network.

## Reference
Mojiri P, Biparva M, Ntiri EE, Ramirez J, Boone L, Holmes M, Adamo S, Gao F, Ozzoude M, Scott C, Dowlatshahi D, Lawrence-Dewar J, Kwan D, Lang A, Marcotte K, Leonard C, Rochon E, Heyn C, Bartha R, Strother S, Tardif JC, Symons S, Masellis M, Swartz R, Moody A, Black SE*, Goubran M*. Deep Bayesian networks for uncertainty estimation and adversarial resistance of white matter hyperintensity segmentation. _Human Brain Mapping_ 2022. doi: https://doi.org/10.1002/hbm.25784

## License

HyperMapp3r_lite is licensed under the terms of the GNU General Public License v3.0.

HyperMapp3r_lite is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. You should have received a copy of GNU General Public License v3.0 along with HyperMapp3r_lite.

The code is released for academic research use only. For commercial use, please contact [maged.goubran@sri.utoronto.ca](mailto:maged.goubran@utoronto.ca).


# Installation

```
wget -O hypermapper_lite.sif https://www.dropbox.com/s/1qsb7wqxfr0zt3b/hypermapper_lite.sif?dl=0
```

or docker image:

```
wget -O hypermapper_lite.tar.gz https://www.dropbox.com/s/zawzvfebnj6jxps/hypermapper_lite.tar.gz?dl=0
```

```
docker load < hypermapper_lite.tar.gz
```

# Usage examples
### singularity
```
singularity run \

  --bind <in_dir>:/indir \
  
  --bind <out_dir>:/outdir

  --pwd / \

  <sif_dir>/hypermapper_lite.sif  \

  -out <out_fn> \

  -fl <fl_fn> \

  -t1 <t1_fn> \

  -d <dropout> \

  -i <n_iterations> 
```

### or docker
```
docker run \

  -v <in_dir>:/indir \
  
  -v <out_dir>:/outdir \

  hypermapper_lite \

  -fl <fl_fn> \

  -t1 <t1_fn> \

  -out <out_fn> \

  -i <n_iterations> \

  -d <dropout>
```

### where:
```
  <in_dir> : directory containing input T1 and FLAIR e.g. $(pwd)

  <out_dir> : directory to write output e.g. $(pwd)

  <sif_dif> : directory containing singularity image (if using)

  <out_fn> : output filename (written to <data_dir>)

  <fl_fn> : FLAIR filename (masked, bias corrected)

  <t1_fn> : T1 filename (masked, bias corrected)

  -<dropout> : amount of test-time dropout [0,1]

  -t : [optional] adds a small amount of test-time augmentation (rotation/flip)

  <n_iterations> : number of iterations (if using dropout/augmentation)
```
  
  




